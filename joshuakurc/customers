create view "RIOT_SHOPIFY"."SHOPIFY_RIOTSTORES"."CUSTOMERS_FLATTENED" AS (

select 
    ACCEPTS_MARKETING,
    ACCEPTS_MARKETING_UPDATED_AT,
    addresses.value:address1::string as cust_address1,
    addresses.value:address2::string as cust_address2,
    addresses.value:city::string as cust_city,
    addresses.value:company::string as cust_company,
    addresses.value:country::string as cust_country,
    addresses.value:country_code::string as cust_country_code,
    addresses.value:country_name::string as cust_country_name,
    addresses.value:customer_id::string as customer_id,
    addresses.value:default::string as cust_default,
    addresses.value:first_name::string as cust_first_name,
    addresses.value:last_name::string as cust_last_name,
    addresses.value:id::string as cust_id,
    addresses.value:name::string as cust_name,
    addresses.value:phone::string as cust_phone,
    addresses.value:province::string as cust_province,
    addresses.value:province_code::string as cust_province_code,
    addresses.value:zip::string as cust_zip,  
    ADMIN_GRAPHQL_API_ID,
    CREATED_AT,
    CURRENCY,
   // DEFAULT_ADDRESS,
    default_address:address1::string as cust_def_address1,
    default_address:address2::string as cust_def_address2,
    default_address:city::string as cust_def_city,
    default_address:company::string as cust_def_company,
    default_address:country::string as cust_def_country,
    default_address:country_code::string as cust_def_country_code,
    default_address:country_name::string as cust_def_country_name,
    default_address:customer_id::string as cust_def_customer_id,
    default_address:default::string as cust_def_default,
    default_address:first_name::string as cust_def_first_name,
    default_address:last_name::string as cust_def_last_name,
    default_address:id::string as cust_def_id,
    default_address:name::string as cust_def_name,
    default_address:phone::string as cust_def_phone,
    default_address:province::string as cust_def_province,
    default_address:province_code::string as cust_def_province_code,
    default_address:zip::string as cust_def_zip,  
    EMAIL,
    FIRST_NAME,
    ID,
    LAST_NAME,
    LAST_ORDER_ID,
    LAST_ORDER_NAME,
    MULTIPASS_IDENTIFIER,
    NOTE,
    ORDERS_COUNT,
    PHONE,
    STATE,
    TAGS,
    TAX_EXEMPT,
    TOTAL_SPENT,
    UPDATED_AT,A
    VERIFIED_EMAIL,
    _SDC_BATCHED_AT,
    _SDC_EXTRACTED_AT,
    _SDC_RECEIVED_AT,
    _SDC_SEQUENCE,
    _SDC_TABLE_VERSION

FROM "RIOT_SHOPIFY"."SHOPIFY_RIOTSTORES"."CUSTOMERS"
,lateral flatten(input => ADDRESSES) addresses
  );
  


